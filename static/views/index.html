<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
    <link href="/static/css/styles.css" rel="stylesheet">
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <link href="/static/css/bootstrap-social.css" rel="stylesheet">
    <link href="/static/css/fileinput.css" rel="stylesheet">
    <link href="/static/css/font-awesome.css" rel="stylesheet">
    <link href="/static/themes/explorer-fa/theme.css" rel="stylesheet">
    
    <title>Index Page</title>
</head>

<body>
    <!-- fix top nav bar-->
    <nav class="navbar navbar-inverse navbar-toggleable-sm bg-primary fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#"><img height="30" width="41" src=""></a>
            <div class="collapse navbar-collapse" id="Navbar">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="#"><span class="fa fa-home fa-lg mr-1"></span>Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-toggle="modal" data-target="#digestModal"><span class="fa fa-scissors mr-1"></span>Digest</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><span class="fa fa-question mr-1"></span>QATest</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><span class="fa fa-wechat mr-1"><span class="info"></span>Contact</a>
                    </li>
                </ul>

                <span class="navbar-text">
                    {{ if . }}
                        <div class="btn-group">
                            <button type="button" class="btn btn-info">{{.Username}}</button>
                            <button type="button" class="btn btn-success dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="sr-only">Toggle Dropdown</span>
                            </button>
                          <div class="dropdown-menu">
                              <a class="dropdown-item" href="#"><span>Settings</span><img class="rounded-circle" style="width: 25px; height: 25px; float: right;" src="{{.Avatar}}" alt="头像"/></a>
                              <div class="dropdown-divider"></div>
                              <a class="dropdown-item btn btn-danger" href="/api/logout">Sign out</a>
                          </div>
                        </div>

                    {{else }}
                        <a data-toggle="modal" data-target="#loginModal">
                            <span class="fa fa-sign-in mr-1"></span>Login
                        </a>
                    {{ end }}
                </span>
            </div>
        </div>
    </nav>

    <div class="modal fade" role="dialog" id="loginModal">
        <div class="modal-dialog" role="content">
            <div class="modal-content">
                <form method="get" action="/api/login" id="login-form">
                    <div class="modal-header">
                        <h4 class="modal-title">Login</h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <div class="modal-body" id="login-body">
                        <div class="form-group row">
                            <label for="firstname" class="col-md-3 col-form-label">First Name</label>
                            <div class="col-md-9">
                                <input type="text" class="form-control" id="username" name="username" placeholder="User Name">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="password" class="col-md-3 col-form-label">Password</label>
                            <div class="col-md-9">
                                <div class="input-group">
                                    <input class="form-control" id="password" name="password" type="password" placeholder="Password">
                                    <div class="input-group-addon" id="password-disp"><a><span class="fa fa-eye"></span></a></div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row" style="margin-bottom: 0px;">
                            <div class="form-check col-md-6 offset-md-3">
                                <label class="form-check-label">
                                    <input type="checkbox" class="form-check-input" name="approve" value="">
                                    <strong>Remeber you?</strong>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="modal-body">
                        <div class="row" style="margin-right: -60px;">
                            <div class="col-md-7">
                                <a class="btn btn-social-icon btn-google-plus" href="#" title="googleplus"><i class="fa fa-google-plus"></i></a>
                                <a class="btn btn-social-icon btn-facebook" href="#" title="facebook"><i class="fa fa-facebook"></i></a>
                                <a class="btn btn-social-icon btn-linkedin" href="#" title="linkedin"><i class="fa fa-linkedin"></i></a>
                                <a class="btn btn-social-icon btn-twitter" href="#" title="twitter"><i class="fa fa-twitter"></i></a>
                                <a class="btn btn-social-icon btn-github" href="javascript:void(0)" title="github"><i class="fa fa-github"></i></a>
                            </div>
                            <div class="col-md-5">
                                <button type="submit" class="btn btn-primary">Login</button>
                                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <!-- digest upload div-->
    <div class="modal fade" role="dialog" id="digestModal">
        <div class="modal-dialog" role="content">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Upload paper</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <div class="modal-content">
                    <div class="file-loading">
                        <input id="digest-upload" name="digest-upload[]" type="file" multiple>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end digest upload div-->



    <header class="jumbotron">
        <div class="container">
            <div class="row">
                <div class="col">
                    <div class="carousel slide" id="mycarousel" data-ride="carousel">
                        <div class="carousel-inner" role="listbox">
                            <div class="carousel-item active">
                                <img class="d-block img-fluid" src="" alt="First Carousel">
                                <div class="carousel-caption d-none d-md-block">
                                    <h2>First Item<span class="badge badge-danger">HOT</span></h2>
                                    This is the description.
                                </div>
                            </div>
                            <div class="carousel-item">
                                <img class="d-block img-fluid" src="" alt="Second Carousel">
                                <div class="carousel-caption d-none d-md-block">
                                    <h2>Second Item</h2>
                                </div>
                            </div>
                        </div>

                        <ol class="carousel-indicators">
                            <li data-target="#mycarousel" data-slide-to="0" class="active"></li>
                            <li data-target="#mycarousel" data-slide-to="1"></li>
                        </ol>
                        <a class="carousel-control-prev" href="#mycarousel" role="button" data-slide="prev">
                            <span class="carousel-control-prev-icon"></span>
                        </a>
                        <a class="carousel-control-next" href="#mycarousel" role="button" data-slide="next">
                            <span class="carousel-control-next-icon"></span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>


    <footer>
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-12 col-md-4">
                    <a>asdf</a>
                </div>
                <div class="col-12 col-md-4">
                    <a>asdf</a>
                </div>
                <div class="col-12 col-md-4">
                    <a>asdf</a>
                </div>
            </div>
            <div class="row">
                <div class="container col-auto">
                    @2018 Designed by LeeJiazheng
                </div>
            </div>
        </div>
    </footer>

    <script src="/static/js/jquery-3.2.1.min.js"></script>
    <script src="/static/js/plugins/sortable.js"></script>
    <script src="/static/js/fileinput.js"></script>
    <script src="/static/themes/explorer-fa/theme.js"></script>
    <script src="/static/themes/fa/theme.js"></script>
    <script src="/static/js/tether.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.cookie.js"></script>
    <script>
        $(document).ready(function(){
            /**
             * Login Function,,, ajax-api, If login successfully, refresh the page.
             * If not, show the error msg.*/
            $("#login-form").submit(function (event) {
                event.preventDefault()
                var form = $(this);
                $.ajax({
                    type: form.attr('method'),
                    url: form.attr('action'),
                    data: form.serialize(),
                    success: function (msg) {
                        if (JSON.parse(msg).error) {
                            $("#login-body").prepend('<div class="alert alert-dismissible alert-danger fade show" role="alert">\n' +
                                    '           <span id="login-alert-content">' + JSON.parse(msg).error + '</span>\n' +
                                    '               <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n' +
                                    '                   <span aria-hidden="true">&times;</span>\n' +
                                    '               </button>\n' +
                                    '      </div>')
                        } else {
                            // login successfully, refresh the page
                            location.reload()
                        }
                    },
                })
            })
            /**
             * Carousel picture in the index page*/
            $('#mycarousel').click(function(){
                if($('#carousel-button').children("span").hasClass("fa-pause")) {
                    $('#mycarousel').carousel('pause');
                    $('#carousel-button').children("span").removeClass("fa-pause");
                    $('#carousel-button').children("span").addClass("fa-play");
                } else {
                    $('#mycarousel').carousel('cycle');
                    $('#carousel-button').children("span").removeClass("fa-play");
                    $('#carousel-button').children("span").addClass("fa-pause");
                }
            })
            /**
             * Password visible toggle button.*/
            $('#password-disp').click(function() {
               if ($('#password').attr('type') == undefined) {
                   $('#password').attr('type', "password");
               } else {
                   $('#password').removeAttr('type');
               }
            });
            /**
             * oAuth2 page forward assembled url.*/
            $('.btn-social-icon').click(function() {
                // get the inc Name by third class.
                location.href = "/oauth2/" + $(this).attr("class").split(' ')[2].slice(4) + "/redirect"
            });

            /**
             * Digest upload pdf/doc file inputs, must load the font-awesome.css for this example*/
            // file_datas is used to store files meta data
            var file_datas = {}
            $("#digest-upload").fileinput({
                theme: "explorer-fa",
                uploadUrl: "/api/digest/paper",
                minFileCount: 1,
                maxFileCount: 5,
                overwriteInitial: false,
                previewFileIcon: '<i class="fa fa-file"></i>',
                initialPreview: [
                    // IMAGE DATA
                    'https://picsum.photos/800/560?image=1071',
                    // IMAGE RAW MARKUP
                    '<img src="https://picsum.photos/800/560?image=1075" class="kv-preview-data file-preview-image">',
                    // TEXT DATA
                    "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec ut mauris ut libero fermentum feugiat eu et dui. Mauris condimentum rhoncus enim, sed semper neque vestibulum id. Nulla semper, turpis ut consequat imperdiet, enim turpis aliquet orci, eget venenatis elit sapien non ante. Aliquam neque ipsum, rhoncus id ipsum et, volutpat tincidunt augue. Maecenas dolor libero, gravida nec est at, commodo tempor massa. Sed id feugiat massa. Pellentesque at est eu ante aliquam viverra ac sed est.",
                    // PDF DATA
                    'http://kartik-v.github.io/bootstrap-fileinput-samples/samples/pdf-sample.pdf',
                    // VIDEO DATA
                    "http://kartik-v.github.io/bootstrap-fileinput-samples/samples/small.mp4"
                ],
                initialPreviewAsData: true, // defaults markup
                initialPreviewConfig: [
                    {caption: "Image 11.jpg", size: 762980, url: "/site/file-delete", downloadUrl: 'https://picsum.photos/800/460?image=11', key: 11},
                    {previewAsData: false, size: 823782, caption: "Image 13.jpg", url: "/api/digest/paper", downloadUrl: 'https://picsum.photos/800/460?image=13', key: 13},
                    {caption: "Lorem Ipsum.txt", type: "text", size: 1430, url: "/site/file-delete", key: 12},
                    {type: "pdf", size: 8000, caption: "PDF Sample.pdf", url: "/site/file-delete", key: 14},
                    {type: "video", size: 375000, filetype: "video/mp4", caption: "Krajee Sample.mp4", url: "/site/file-delete", key: 15}
                ],
                uploadExtraData: {
                    img_key: "1000",
                    img_keywords: "happy, nature"
                },
                preferIconicPreview: true, // this will force thumbnails to display icons for following file extensions
                previewFileIconSettings: { // configure your icon file extensions
                    'doc': '<i class="fa fa-file-word-o text-primary"></i>',
                    'xls': '<i class="fa fa-file-excel-o text-success"></i>',
                    'ppt': '<i class="fa fa-file-powerpoint-o text-danger"></i>',
                    'pdf': '<i class="fa fa-file-pdf-o text-danger"></i>',
                    'zip': '<i class="fa fa-file-archive-o text-muted"></i>',
                    'htm': '<i class="fa fa-file-code-o text-info"></i>',
                    'txt': '<i class="fa fa-file-text-o text-info"></i>',
                    'mov': '<i class="fa fa-file-movie-o text-warning"></i>',
                    'mp3': '<i class="fa fa-file-audio-o text-warning"></i>',
                },
                previewFileExtSettings: { // configure the logic for determining icon file extensions
                    'doc': function(ext) {
                        return ext.match(/(doc|docx)$/i);
                    },
                    'xls': function(ext) {
                        return ext.match(/(xls|xlsx)$/i);
                    },
                    'ppt': function(ext) {
                        return ext.match(/(ppt|pptx)$/i);
                    },
                    'zip': function(ext) {
                        return ext.match(/(zip|rar|tar|gzip|gz|7z)$/i);
                    },
                    'htm': function(ext) {
                        return ext.match(/(htm|html)$/i);
                    },
                    'txt': function(ext) {
                        return ext.match(/(txt|ini|csv|java|php|js|css)$/i);
                    },
                    'mov': function(ext) {
                        return ext.match(/(avi|mpg|mkv|mov|mp4|3gp|webm|wmv)$/i);
                    },
                    'mp3': function(ext) {
                        return ext.match(/(mp3|wav)$/i);
                    }
                }
            }).on('fileuploaded', function(event, data, previewId, index) {
                // the index is also point to the file_datas
                file_datas[previewId] = data.response

                var form = data.form, files = data.files, extra = data.extra,
                    response = data.response, reader = data.reader;
                debugger
                console.log('File uploaded triggered');
            }).on('filesuccessremove', function(event, id) {
                console.log(file_datas)
                $.ajax({
                    url: "/api/digest/paper/" + file_datas[id].id,
                    type: "DELETE",
                    success: function (msg) {
                        console.log(msg)
                        debugger
                    },
                })
                delete file_datas[id]
                debugger
            });


        });
    </script>
</body>
</html>